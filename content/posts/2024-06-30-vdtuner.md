---
author: "Chao.G"
title: "VDTuner论文闲谈"
date: "2024-06-30"
markup: "mmark"
draft: false
tags: ["ann"]
categories: ["Papers"]
---

本文不是对VDTuner这篇论文完整的解读，只是一些观察。有兴趣可以看原作者的解读文章[https://zhuanlan.zhihu.com/p/696553201](https://zhuanlan.zhihu.com/p/696553201)。

## OtterTune

其实对于tuning相关的工具，最鼎鼎大名的就是著名数据库网红Andy教授主导的OtterTune项目。在看论文的过程中，有一个感觉，这类的tuning工具如何能够真正落地使用呢，首先适合in-house来做，比如像蚂蚁如果内部搭建了一套向量数据库系统服务自己的业务，然后每隔一段时间来做一下参数的学习达到最好的效果。如果用在数据库SaaS服务之上，用户那边有DBA来触发仍然没问题，但最理想的情况是用户更无脑丝滑地用SaaS，这时候要做到非常自动地tuning，如何控制训练成本和时机感觉还是挺复杂的。

想到这里就想看看OtterTune主要的用户是在哪里，直接迎面就是一个company is dead。这个风格带着Andy一如既往的某种简短直接，甚至让人觉得像是在幽默。但是后来发现确实在6月份OtterTune已经确实无了。只能说是一些非产品的一些原因，本身tuning工具仍然是一个非常有意思的产品，或者说是AI for DB里面最有希望获得成功的方向了。

![ottertune](/assets/vdtuner-ottertune.png)


## Milvus

很多论文的对象已经从向量索引走到了向量数据库，这篇文章也是，Milvus（开源向量数据库）正在成为论文写作中重要的baseline。成为baseline肯定不是坏事，就像研究向量算法无数paper都把HNSW、IVFPQ这类算法作为baseline，首先成为baseline得使用上已经非常广泛，并且是有其优势所在的。而且从实用主义的角度出发，最后使用的其实大部分都还是HNSW，IVFPQ这类算法。。

但是要把这样一个系统拿来做论文实验其实不算太容易，不过好在tuning工具不需要修改内核代码。虽然论文基本是把索引无关的系统参数当成黑盒来看待的，但选择出要调整的参数这件事本身就已经有一定的理解了。

## 如何更高效地做调参

论文的主要亮点就是需要减少调参的空间，更高效去做tuning。

目标是search speed和recall两个点，多目标贝叶斯优化用来权衡两个互相冲突的目标。如何把这个目标具体量化，使用预期超容量改进（Expected Hyper Volume Improvement, EHVI）指标，从我朴素的理解来看就像是一个整体边际效益的意思。

优化过程中，系统参数和索引参数会被分开进行处理，系统参数几乎在不同索引类型里是共享的，这类相同参数在不同索引类型学到的知识可以共享。并且对于不同索引并不会一视同仁，早期探索一个新的索引类型，观察到这个索引性能非常差，那么逐步会被放弃，转而对性能尚可的索引类型的参数空间进行调优。

![vdtuner](/assets/vdtuner-overview.png)

## 一点点思考

1. Tuning的开销还是很大的，主要在不同建索引参数带来很大的构建开销，下图是论文中百万级别的数据集上验证的开销。对于这一点我的感觉，其实对于索引的选择和索引构建参数的选择其实往往根据经验可以设置一个相对还不错的值，这时候调参在建索引上不需要太多的开销。

![exp](/assets/vdtuner-exp.png)

2. Tuning面对的系统状态仍然是一个比较稳定的状态，这个点没有问题，但是当一个系统在持续地insert/delete，甚至后台还会有compaction之类的操作，如何去做低成本的调整，这个问题感觉还挺有趣的。

3. 对于多种查询方式的适应性，对于一份相同的数据可以有多种多样的query pattern，当然简单地是对每一种查询类型做调优，如果能找到某种共性降低调优的成本，相信也会是很有价值的。

## Reference

- https://zhuanlan.zhihu.com/p/696553201
- https://arxiv.org/pdf/2404.1041
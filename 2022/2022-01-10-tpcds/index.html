<!doctype html><html lang=zh-cn><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="chrome=1"><meta name=viewport content="width=device-width,initial-scale=1"><meta name=robots content="noodp"><meta name=author content="Chao.G"><meta name=description content="高超的个人博客"><link rel=prev href=https://chasingegg.github.io/2021/2021-11-09-spark0.1/><link rel=next href=https://chasingegg.github.io/2022/2022-02-01-farewell-2021/><link rel=canonical href=https://chasingegg.github.io/2022/2022-01-10-tpcds/><link rel=apple-touch-icon sizes=180x180 href=/apple-touch-icon.png><link rel=icon type=image/png sizes=32x32 href=/favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=/favicon-16x16.png><link rel=manifest href=/site.webmanifest><link rel=mask-icon href=/safari-pinned-tab.svg color=#5bbad5><meta name=msapplication-TileColor content="#da532c"><meta name=theme-color content="#ffffff"><title>TPC和TPC-DS的介绍 | Chao.G</title><meta name=title content="TPC和TPC-DS的介绍 | Chao.G"><link rel=stylesheet href=/css/main.min.css><script type=application/ld+json>{"@context":"http://schema.org","@type":"BlogPosting","mainEntityOfPage":{"@type":"WebPage","@id":"https:\/\/chasingegg.github.io"},"articleSection":"posts","name":"TPC和TPC-DS的介绍","headline":"TPC和TPC-DS的介绍","description":"做数据库相关的同学，相信近几年一定听过很多新闻，比如蚂蚁OceanBase在TPC-C榜单上拿下第一，阿里云AnalyticDB在TPC-H","inLanguage":"zh-cn","author":"Chao.G","creator":"Chao.G","publisher":"Chao.G","accountablePerson":"Chao.G","copyrightHolder":"Chao.G","copyrightYear":"2022","datePublished":"2022-01-10 00:00:00 \u002b0000 UTC","dateModified":"2022-01-10 00:00:00 \u002b0000 UTC","url":"https:\/\/chasingegg.github.io\/2022\/2022-01-10-tpcds\/","wordCount":"3430","keywords":["benchmark","Chao.G"]}</script></head><body><div class=wrapper><nav class=navbar><progress class=content_progress max=0 value=0></progress><div class=container><div class="navbar-header header-back2home-logo"><span class=logo_mark>>$</span>
<a href=https://chasingegg.github.io><span class=logo_text>cd /home/</span>
<span class=logo_cursor></span></a></div><div class=navbar-right><span class=menu><a class=menu-item href=/posts/ title>Blog</a>
<a class=menu-item href=/categories/ title>Categories</a>
<a class=menu-item href=/tags/ title>Tags</a>
<a class=menu-item href=/about/ title>About</a>
<span class=divide></span><a href=javascript:void(0); class=theme-switch><i class="iconfont icon-dark-mode"></i></a></span></div></div></nav><nav class=navbar-mobile id=nav-mobile style=display:none><progress class=content_progress max=0 value=0></progress><div class=container><div class=navbar><div class="navbar-header header-logo"><a href=https://chasingegg.github.io>Chao.G</a></div><div class=navbar-right><div><a href=javascript:void(0); class=theme-switch><i class="iconfont icon-dark-mode"></i></a></div><div class=menu-toggle><span></span><span></span><span></span></div></div></div><div class=menu id=mobile-menu><nav class=mb-md><a class=menu-item href=/posts/ title><h3>Blog</h3><div class=menu-active></div></a><a class=menu-item href=/categories/ title><h3>Categories</h3><div class=menu-active></div></a><a class=menu-item href=/tags/ title><h3>Tags</h3><div class=menu-active></div></a><a class=menu-item href=/about/ title><h3>About</h3><div class=menu-active></div></a></nav></div></div></nav><main class=main><div class=container><article class=post-warp itemscope itemtype=http://schema.org/Article><header class=post-header><h1 class=post-title itemprop="name headline">TPC和TPC-DS的介绍</h1><div class=post-meta>Written by <a itemprop=name href=https://chasingegg.github.io rel=author>Chao.G</a> with ♥
<span class=post-time>on <time datetime=2022-01-10 itemprop=datePublished>January 10, 2022</time></span>
in
<i class="iconfont icon-folder"></i><span class=post-category><a href=https://chasingegg.github.io/categories/share/>Share,</a></span>
<span class=post-word-count>3430 words</span></div></header><div class=post-content><p>做数据库相关的同学，相信近几年一定听过很多新闻，比如蚂蚁OceanBase在TPC-C榜单上拿下第一，阿里云AnalyticDB在TPC-H榜单上拿下第一等。感觉TPC-X就是一个衡量数据库性能的标准，各公司希望在这个公认的平台上去获得一个好"成绩"，就像是一个权威认证的证书一样，自家的产品就更好卖。花了一点时间简单看了下TPC的背景，由于我的工作主要是在OLAP方向，就以TPC-DS为例做个介绍。</p><h2 id=tpc的起源和发展>TPC的起源和发展</h2><p>TPC的官方网站在这里<a href=http://tpc.org/>http://tpc.org</a>，在主页上飘着一行小字：The TPC is a non-profit corporation focused on developing data-centric benchmark standards and disseminating objective, verifyable data to the industry. TPC起到两个作用：1. 创造不错的benchmark，2. 创造一个不错的review流程。好的benchmark就像是好的法律，而好的review流程就像是警察，律师，法官这样的角色。因为不管benchmark的细节做到多么细致，总有些所谓的"灰色地带"，而好的review流程就可以比较好地处理这些问题。</p><p>在80年代初期，交易的自动化越来越普及，比如ATM机，并逐渐扩展到各种方面比如售货店买东西，加油站加油等，即所谓的OnLine Transaction Processing，OLTP系统开始涌现。此时出现了一些benchmark，比如IBM提出的TP1，Jim Gray等人提出的DebitCredit，而因为缺乏很好的review和发布流程，这会让大家的性能结果可信度较低，往往是一片混乱。最终在1988年，Omri Serlin联合了一些公司成立了TPC，也就是Transaction Processing Performance Council。</p><p>随之诞生的就是TPC-A（基于DebitCredit）和TPC-B（基于TP1）benchmark，TPC-B和TPC-A的主要区别在于TPC-B可以看作是TPC-A的batch模式，从端上的用户来看，他执行一些少量简单的交易操作，这是TPC-A，而对于那些卖服务器或者卖数据库的公司来说，衡量系统批量处理交易的能力可能更加重要，这是TPC-B。每一个TPC的结果需要有一份Full Disclosure Report，由审核人员进行review，如果有对公开的结果提出异议，会由Technical Advisory Board进行重新review，最后TPC组织根据他们的报告来判断是否需要移除结果。</p><p>TPC组织总是希望可以构建更好的benchmark，workloads会随着应用发展的变化而变化，比如TPC-A和TPC-B已经不再使用，OLTP的标准现在是TPC-C。另外TPC也不再局限于做TP领域的benchmark，对于不同的workloads都有对应的benchmark，比如用于决策支持的TPC-DS。</p><h2 id=tpcds>TPC-DS</h2><p>首先简单理解下决策支持（decision support）的含义，字面上来看就是在一定的业务场景下帮助做一些决策的系统，在我看来就是和OLAP的概念是可以对应起来的，就是对大规模的数据做一些真实业务场景下的分析查询，根据结果做一些相关业务决策。</p><p>最早决策支持的benchmark是1994年出来的TPC-D，但当时的复杂查询经过优化器的不断进化已经变得非常快了，而且数据量比较小。在1999年TPC-H诞生，增加了更大规模数据的测试，以及增加了一些查询，但变化较小。最终TPC-DS作为衡量state-of-the-art的决策支持系统性能的最新benchmark，经历了十多年的发展正式成为TPC家族的一员。</p><p>在<a href=http://tpc.org/tpc_documents_current_versions/current_specifications5.asp>这里</a>我们可以获取到TPC-DS的说明文档和代码。</p><h3 id=背景>背景</h3><p>TPC-DS会使用一个真实的业务场景，商品零售来测试系统性能。构建了一个大型跨国零售公司的业务模型，包含多家专卖店，同时也在线上销售，包含了库存管理系统和促销系统。业务模型分为以下三个方面</p><ul><li><p>数据模型和数据访问：采用雪花模型，有一系列的事实表和维度表，维度表分为以下几类：static（比如日期维度，不会改变），historical（历史记录保留，时间戳代表是否合法，比如item维度），non-historical（新纪录覆盖历史记录，总是使用最新数据，比如customer维度）。包含7张事实表：store_sales，store_returns，catalog_sales，catalog_returns，web_sales，web_returns，inventory。三种渠道的销售和利润数据，以及跟促销有关的数据，还有17张维度表：store，call_center，catalog_page，web_site，web_page，warehouse，customer，customer_address，customer_demographics，date_dim，household_demographics，item，income_band，promotion，reason，ship_mode，time_dim。测试数据大小包含多种size，1TB，3TB，10TB，30TB，100TB。使用SF（Scale Factor）来控制数据规模。</p></li><li><p>查询模型：包含了多种查询类型，比如查询模式比较固定的报表类查询，比如ad-hoc查询，比如一些包含多join和聚合运算的复杂查询。分析的数据量大，并且都是在回答真实场景下的商业问题。</p></li><li><p>数据维护（data maintenance，记作DM）：这是TPC-DS v3新增的一个测试。OLAP系统的有效性是由业务数据作为基础的，因此从OLTP系统到OLAP系统的数据导入这一步也是很关键的，阶段性的数据"refresh"是数据仓库不可或缺的部分，加入这一个角度使得TPC-DS benchmark更加全面，公平。过程包括加载数据，同时把数据转化成目标格式，删除过期数据，插入新的事实表数据。即包含常说的ETL中的T（Transformation）和L（Load），不包含E（Extraction），也就是下图中flat files的产生过程忽略。<figure><img src=/assets/tpcds-etl.png alt=tpcds-etl loading=lazy></figure></p></li></ul><h3 id=测试>测试</h3><p>测试分为以下几个流程，有先后顺序</p><ol><li>Load Test</li><li>Power Test</li><li>ThroughPut Test 1</li><li>Data Maintenance Test 1</li><li>Throughput Test 2</li><li>Data Maintenance Test 2</li></ol><p>Power test是单线程处理一个query stream（包含99个查询），而Throughput test是并行处S个（TPC-DS要求>=4）query streams，相当于是压测。跑完性能测试以后就开始Data maintenance test做一些数据refresh，替换成新的数据。</p><p>测试完成以后，需求有指标来衡量结果。TPC-DS给出了3个主要指标</p><ul><li>Performance Metric，QPhDS@SF</li><li>Price-Performance Metric，$/kQphDS@SF</li><li>System availability date</li></ul><p>第一个性能指标直接上原图，SF控制了测试数据规模，Q代表query个数，由于Throughput test会跑几批query streams，总数记为<span class=math>\(S_q\)</span> * 99，于是在<span class=math>\(T_{PT}\)</span>上面我们需要把真实Power test的时间去乘上这个<span class=math>\(S_q\)</span>保证量纲。</p><p><figure><img src=/assets/tpcds-metrics.png alt=tpcds-metrics loading=lazy></figure></p><p>第二个价格-性能指标就是计算单位性能指标上的价格，<span class=math>\(\frac{1000 * p}{QphDS@SF}\)</span>。</p><p>第三个即为系统开放的可用时间。</p><h2 id=报告>报告</h2><p>最终需要提交一份Full Disclosure Report（FDR），包含以下内容</p><ul><li>Report：完整环境搭建，测试结果等。</li><li>Executive Summary：包含Load Test，Power Test，Throughput Test，Data Maintenance Test的结果，其实Report也包含这部分，单独把这个拎出来作为一个单独文件，毕竟这是核心指标。</li><li>Support files：代码，脚本等。</li></ul><p>这个标准是可以让用户可以按照报告中的描述去复现结果。</p><p>有兴趣可以去看Databricks在2021年11月2日提交的最新TPC-DS Report，<a href="http://tpc.org/tpcds/results/tpcds_result_detail5.asp?id=121103001">http://tpc.org/tpcds/results/tpcds_result_detail5.asp?id=121103001</a>。报告需要按照严格的标准来书写，比如运行架构设计，硬件配置，逻辑表设计，存储设计，查询参数和SQL调整，性能指标，硬件软件价格，审核人相关信息，在TPC-DS的说明文档里有很详细的描述，基本可以按照其描述逐一回答各个问题即可。</p><p>2021年11月Databricks的这次打榜在100TB数据集上做到了第一，取代了原来阿里EMR的位置。有机会可以看看Databricks底层Photon引擎的一些东西，现在外部能看到的东西还比较少，可能之后也会有论文出来吧。</p><h2 id=reference>Reference</h2><ul><li><a href=http://tpc.org/tpc_documents_current_versions/pdf/tpc-ds_v3.2.0.pdf>http://tpc.org/tpc_documents_current_versions/pdf/tpc-ds_v3.2.0.pdf</a></li><li><a href=http://tpc.org/information/about/history5.asp>http://tpc.org/information/about/history5.asp</a></li><li><a href=https://medium.com/hyrise/a-summary-of-tpc-ds-9fb5e7339a35>https://medium.com/hyrise/a-summary-of-tpc-ds-9fb5e7339a35</a></li><li><a href=http://www.tpc.org/tpcds/presentations/the_making_of_tpcds.pdf>http://www.tpc.org/tpcds/presentations/the_making_of_tpcds.pdf</a></li><li><a href=https://databricks.com/blog/2021/11/02/databricks-sets-official-data-warehousing-performance-record.html>https://databricks.com/blog/2021/11/02/databricks-sets-official-data-warehousing-performance-record.html</a></li></ul></div><div class=post-copyright><p class=copyright-item><span>Author:</span>
<span>Chao.G</span></p><p class="copyright-item lincese">本文采用<a rel=license href=http://creativecommons.org/licenses/by-nc/4.0/ target=_blank>知识共享署名-非商业性使用 4.0 国际许可协议</a>进行许可</p></div><div class=post-tags><section><i class="iconfont icon-tag"></i>Tag(s):
<span class=tag><a href=https://chasingegg.github.io/tags/benchmark/>#benchmark</a></span></section><section><a href=javascript:window.history.back();>back</a></span> ·
<span><a href=https://chasingegg.github.io>home</a></span></section></div><div class=post-nav><a href=https://chasingegg.github.io/2021/2021-11-09-spark0.1/ class=prev rel=prev title="Spark Alpha-0.1"><i class="iconfont icon-left"></i>&nbsp;Spark Alpha-0.1</a>
<a href=https://chasingegg.github.io/2022/2022-02-01-farewell-2021/ class=next rel=next title=再见2021>再见2021&nbsp;<i class="iconfont icon-right"></i></a></div><div class=post-comment><div id=utteranc-container><script src=https://utteranc.es/client.js repo=chasingegg/chasingegg.github.io issue-term=title theme=preferred-color-scheme crossorigin=anonymous async></script></div></div></article></div></main><footer class=footer><div class=copyright>&copy;
<span itemprop=copyrightYear>2021 - 2023</span>
<span class=with-love><i class="iconfont icon-love"></i></span><span class=author itemprop=copyrightHolder><a href=https://chasingegg.github.io>Chao.G</a> |</span>
<span>Powered by <a href=https://gohugo.io/ target=_blank rel="external nofollow">Hugo</a> & <a href=https://github.com/Mogeko/Mogege target=_blank rel="external nofollow">Mogege</a></span></div></footer><script defer src=/js/vendor_main.min.js></script><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/katex@0.11.1/dist/katex.min.css integrity="sha256-V8SV2MO1FUb63Bwht5Wx9x6PVHNa02gv8BgH/uH3ung=" crossorigin=anonymous><script defer src=https://cdn.jsdelivr.net/npm/katex@0.11.1/dist/katex.min.js integrity="sha256-F/Xda58SPdcUCr+xhSGz9MA2zQBPb0ASEYKohl8UCHc=" crossorigin=anonymous></script><script defer src=https://cdn.jsdelivr.net/npm/katex@0.11.1/dist/contrib/auto-render.min.js integrity="sha256-90d2pnfw0r4K8CZAWPko4rpFXQsZvJhTBGYNkipDprI=" crossorigin=anonymous onload=renderMathInElement(document.body)></script><script src=https://cdn.jsdelivr.net/npm/pangu@4.0.7/dist/browser/pangu.min.js integrity="sha256-j+yj56cdEY2CwkVtGyz18fNybFGpMGJ8JxG3GSyO2+I=" crossorigin=anonymous></script><script>pangu.spacingPage()</script></div></body></html>